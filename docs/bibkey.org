#+TITLE:  BibKey Manual
#+AUTHOR: Mykhailo Shevchuk
#+EMAIL:  mail+dev@mshevchuk.com
#+OPTIONS: toc:nil

* BibKey - Automatically generate citation keys
:PROPERTIES:
:CUSTOM_ID: bibkey-configuration
:END:

** =bibkey-format=
:PROPERTIES:
:CUSTOM_ID: bibkey-format
:END:

You can specify the format of autogenerated BibTeX keys by setting the
=bibkey-format= variable through the Customize interface, or by adding a =setq=
form in your Emacs configuration file.

BibKey format currently supports the following wildcards:

*** Basic
:PROPERTIES:
:CUSTOM_ID: basic
:END:

| Wildcard   | Field  | Description                            |
|------------+--------+----------------------------------------|
| %a         | author | first author's (or editor's) last name |
| %t         | title  | first word of title                    |
| %f{field}  | field  | first word of arbitrary field          |
| %y         | year   | year YYYY (date or year field)         |
| %p         | page   | first page                             |
| %e{(expr)} | elisp  | elisp expression                       |

#+begin_example
  (setq bibkey-format "%a%y") => "doe2020"
#+end_example

*** Extended
:PROPERTIES:
:CUSTOM_ID: extended
:END:

1. Capitalized versions:

| Wildcard  | Field  | Description                          |
|-----------+--------+--------------------------------------|
| %A        | author |                                      |
| %T        | title  | Same as %a,%t,%f{field} but          |
| %F{field} | field  | preserve the original capitalization |

#+begin_example
  (setq bibkey-format "%A%y") => "Doe2020"
#+end_example

2. Starred versions

| Wildcard | Field  | Description                                            |
|----------+--------+--------------------------------------------------------|
| %a, %A   | author | - include author's (editor's) initials                 |
| %t, %T   | title  | - do not ignore words in bibkey-titlewords-ignore |
| %y       | year   | - year's last two digits __YY                          |
| %p       | page   | - use "pagetotal" field instead of default "pages"     |

#+begin_example
  (setq bibkey-format "%A*%y") => "DoeJohn2020"
#+end_example

3. Optional parameters

| Wildcard           | Field  | Description                                       |
|--------------------+--------+---------------------------------------------------|
| %a[N][M][D]        | author |                                                   |
| %t[N][M][D]        | title  | > include first N words/names                     |
| %f{field}[N][M][D] | field  | > include at most M first characters of word/name |
| %p[D]              | page   | > put delimiter D between words                   |

=N= and =M= should be a single digit =1-9=. Putting more digits or any other
symbols will lead to ignoring the optional parameter and those following it
altogether. =D= should be a single alphanumeric symbol or one of =-_.:|=.

Optional parameters work both with capitalized and starred versions where
applicable.

#+begin_example
  (setq bibkey-format "%A*[1][4][-]%y") => "DoeJ2020"
  (setq bibkey-format "%A*[2][7][-]:%y") => "DoeJohn-DoeJane:2020"
#+end_example

4. Elisp expression

- can be anything
- should return a string or nil
- will be evaluated before expanding other wildcards and therefore can
  be used to insert other wildcards
- will have entry variable bound to the value of BibTeX entry the key is
  being generated for, as returned by bibtex-completion-get-entry. The
  variable may be safely manipulated in a destructive manner.

#+begin_example
  %e{(or (bibtex-completion-get-value "volume" entry) "N/A")}
  %e{(my-function entry)}
#+end_example

*** Other variables
:PROPERTIES:
:CUSTOM_ID: other-variables
:END:
Check variables =bibkey-invalid-symbols=,
=bibkey-empty-field-token=, =bibkey-titlewords-ignore= for
additional settings.
